<UserControl x:Class="DesktopHub.UI.Widgets.DocQuickOpenWidget"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             HorizontalAlignment="Stretch" Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ContentControl}}">
    
    <UserControl.Resources>
        <SolidColorBrush x:Key="TextBrush" Color="#F5F7FA"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#88F5F7FA"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#4FC3F7"/>
        <SolidColorBrush x:Key="HoverBrush" Color="#18F5F7FA"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#22F5F7FA"/>
        <SolidColorBrush x:Key="InputBgBrush" Color="#15F5F7FA"/>
        <SolidColorBrush x:Key="RevitBrush" Color="#FF6B35"/>
        <SolidColorBrush x:Key="CadBrush" Color="#4FC3F7"/>
        <SolidColorBrush x:Key="CloudBrush" Color="#AB47BC"/>
        
        <Style x:Key="ThinScrollViewer" TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ScrollContentPresenter Grid.Column="0"/>
                            <ScrollBar x:Name="PART_VerticalScrollBar"
                                       Grid.Column="1"
                                       Orientation="Vertical"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                       Width="4"
                                       Opacity="0.3"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    
    <Border Padding="12">
        <StackPanel>
            
            <!-- Header -->
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="Doc Quick Open" FontSize="15" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center"/>
                <Button x:Name="CloseButton" Grid.Column="1" Content="âœ•" FontSize="12" Padding="6,2" 
                        Background="Transparent" Foreground="{StaticResource TextSecondaryBrush}" BorderThickness="0"
                        Click="CloseButton_Click" Cursor="Hand" ToolTip="Close"/>
            </Grid>
            
            <!-- Project Name (auto-populated from search selection) -->
            <Border Background="{StaticResource InputBgBrush}" BorderBrush="{StaticResource BorderBrush}" 
                    BorderThickness="1" CornerRadius="6" Padding="8,6" Margin="0,0,0,6"
                    MouseLeftButtonDown="ProjectNameHeader_DoubleClick" Cursor="Hand"
                    ToolTip="Double-click to copy project path">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="ðŸ“‚" FontSize="13" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBlock x:Name="ProjectNameText" Grid.Column="1" Text="Click a project in search results to begin" FontSize="12" 
                               Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"/>
                    <Border x:Name="ProjectTypeBadge" Grid.Column="2" Visibility="Collapsed"
                            Background="#20FFFFFF" CornerRadius="4" Padding="6,2" Margin="6,0,0,0">
                        <TextBlock x:Name="ProjectTypeBadgeText" FontSize="9" FontWeight="Bold" 
                                   Foreground="{StaticResource CadBrush}" VerticalAlignment="Center"/>
                    </Border>
                </Grid>
            </Border>
            
            <!-- Discipline Selector (CAD projects) -->
            <Border x:Name="DisciplinePanel" Visibility="Collapsed" Margin="0,0,0,6">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Border x:Name="BtnElectrical" Grid.Column="0" Background="#10F5F7FA" CornerRadius="6,0,0,6" 
                            Padding="8,7" Cursor="Hand" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,1,0,1"
                            MouseLeftButtonDown="Discipline_Click" Tag="Electrical"
                            ToolTip="Click to switch Â· Double-click to copy path">
                        <TextBlock Text="âš¡ Electrical" FontSize="11" FontWeight="Medium" Foreground="{StaticResource TextSecondaryBrush}" 
                                   HorizontalAlignment="Center" IsHitTestVisible="False"/>
                    </Border>
                    <Border x:Name="BtnMechanical" Grid.Column="1" Background="#10F5F7FA" CornerRadius="0" 
                            Padding="8,7" Cursor="Hand" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                            MouseLeftButtonDown="Discipline_Click" Tag="Mechanical"
                            ToolTip="Click to switch Â· Double-click to copy path">
                        <TextBlock Text="ðŸ”§ Mechanical" FontSize="11" FontWeight="Medium" Foreground="{StaticResource TextSecondaryBrush}" 
                                   HorizontalAlignment="Center" IsHitTestVisible="False"/>
                    </Border>
                    <Border x:Name="BtnPlumbing" Grid.Column="2" Background="#10F5F7FA" CornerRadius="0,6,6,0" 
                            Padding="8,7" Cursor="Hand" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,1,1"
                            MouseLeftButtonDown="Discipline_Click" Tag="Plumbing"
                            ToolTip="Click to switch Â· Double-click to copy path">
                        <TextBlock Text="ðŸš¿ Plumbing" FontSize="11" FontWeight="Medium" Foreground="{StaticResource TextSecondaryBrush}" 
                                   HorizontalAlignment="Center" IsHitTestVisible="False"/>
                    </Border>
                </Grid>
            </Border>
            
            <!-- Revit Info Panel (Revit projects) -->
            <Border x:Name="RevitInfoPanel" Visibility="Collapsed" Background="#10FF6B35" 
                    BorderBrush="#30FF6B35" BorderThickness="1" CornerRadius="6" Padding="10,8" Margin="0,0,0,6">
                <StackPanel>
                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="ðŸ—" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <TextBlock Grid.Column="1" Text="Revit Project" FontSize="13" FontWeight="SemiBold" 
                                   Foreground="{StaticResource RevitBrush}" VerticalAlignment="Center"/>
                    </Grid>
                    <StackPanel x:Name="RevitDetailsPanel" Margin="22,0,0,0">
                        <TextBlock x:Name="RevitVersionText" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,2"/>
                        <TextBlock x:Name="RevitCloudText" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,2"/>
                        <TextBlock x:Name="RevitCRevitText" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" Visibility="Collapsed"/>
                    </StackPanel>
                </StackPanel>
            </Border>
            
            <!-- Revit Launch Panel (shown for Revit projects with known version) -->
            <Border x:Name="RevitLaunchPanel" Visibility="Collapsed" Margin="0,0,0,6">
                <StackPanel>
                    <!-- Not-installed warning -->
                    <Border x:Name="RevitNotFoundPanel" Visibility="Collapsed" Background="#15FF5252" 
                            CornerRadius="10" Padding="10,5" Margin="0,0,0,6">
                        <TextBlock x:Name="RevitNotFoundText" FontSize="10" Foreground="#FFCC4444" VerticalAlignment="Center"/>
                    </Border>
                    <!-- Pill row: all version pills built by code-behind, stretched to fill width -->
                    <Grid x:Name="VersionPillRow"/>
                </StackPanel>
            </Border>
            
            <!-- Search Box (CAD projects only) -->
            <Border x:Name="SearchPanel" Visibility="Collapsed" Background="{StaticResource InputBgBrush}" 
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" CornerRadius="6" Padding="8,6" Margin="0,0,0,6">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="ðŸ”" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0" Opacity="0.5"/>
                    <TextBox x:Name="SearchBox" Grid.Column="1" FontSize="12" Background="Transparent" 
                             Foreground="{StaticResource TextBrush}" BorderThickness="0" CaretBrush="{StaticResource AccentBrush}"
                             TextChanged="SearchBox_TextChanged" VerticalAlignment="Center"/>
                </Grid>
            </Border>
            
            <!-- Status / Count -->
            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="StatusText" Grid.Column="0" Text="" FontSize="10" 
                           Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                <TextBlock x:Name="CountText" Grid.Column="1" Text="" FontSize="10" 
                           Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"/>
            </Grid>
            
            <!-- Loading indicator -->
            <Border x:Name="LoadingIndicator" Visibility="Collapsed" Margin="0,8,0,8">
                <TextBlock Text="Scanning project..." FontSize="12" Foreground="{StaticResource AccentBrush}" 
                           HorizontalAlignment="Center"/>
            </Border>
            
            <!-- Empty state -->
            <Border x:Name="EmptyState" Visibility="Visible" Margin="0,12,0,12">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock x:Name="EmptyIcon" Text="ðŸ“" FontSize="24" HorizontalAlignment="Center" Margin="0,0,0,6"/>
                    <TextBlock x:Name="EmptyTitle" Text="No project selected" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,0,0,4"/>
                    <TextBlock x:Name="EmptyHint" Text="Click a project in the search results to view its drawings" FontSize="11" 
                               Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center" Opacity="0.6"
                               TextWrapping="Wrap" TextAlignment="Center"/>
                </StackPanel>
            </Border>
            
            <!-- File List -->
            <ScrollViewer x:Name="FileScrollViewer" MaxHeight="340" VerticalScrollBarVisibility="Auto"
                          Visibility="Collapsed" Style="{StaticResource ThinScrollViewer}">
                <StackPanel x:Name="FileListPanel"/>
            </ScrollViewer>
            
            <!-- Recent Files Section -->
            <Border x:Name="RecentSection" Visibility="Collapsed" Margin="0,8,0,0"
                    Background="#10FFFFFF" CornerRadius="6" Padding="8,6">
                <StackPanel>
                    <TextBlock Text="Recent" FontSize="11" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                    <StackPanel x:Name="RecentFilesPanel"/>
                </StackPanel>
            </Border>
            
        </StackPanel>
    </Border>
</UserControl>
